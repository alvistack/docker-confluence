{
  "builders": [
    {
      "changes": [
        "ENV LANG en_US.UTF-8",
        "ENV LC_ALL en_US.UTF-8",
        "ENV SHELL /bin/bash",
        "ENV TZ UTC",
        "ENV CONFLUENCE_OWNER confluence",
        "ENV CONFLUENCE_GROUP confluence",
        "ENV CONFLUENCE_HOME /var/atlassian/application-data/confluence",
        "ENV CONFLUENCE_CATALINA /opt/atlassian/confluence",
        "ENV JVM_MINIMUM_MEMORY 2048m",
        "ENV JVM_MAXIMUM_MEMORY 2048m",
        "ENV CATALINA_CONNECTOR_PROXYNAME \"\"",
        "ENV CATALINA_CONNECTOR_PROXYPORT \"\"",
        "ENV CATALINA_CONNECTOR_SCHEME http",
        "ENV CATALINA_CONNECTOR_SECURE false",
        "ENV CATALINA_CONTEXT_PATH \"/\"",
        "ENV JVM_SUPPORT_RECOMMENDED_ARGS -Datlassian.plugins.enable.wait=300 -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MaxRAMFraction=1",
        "ENV SESSION_TIMEOUT 300",
        "ENV PATH $PATH:$CONFLUENCE_CATALINA/bin",
        "VOLUME $CONFLUENCE_HOME",
        "WORKDIR $CONFLUENCE_HOME",
        "EXPOSE 8000",
        "EXPOSE 8090",
        "ENTRYPOINT [\"catatonit\", \"-g\", \"--\", \"docker-entrypoint.sh\"]",
        "CMD [\"start-confluence.sh\", \"-fg\"]"
      ],
      "commit": true,
      "image": "ubuntu:20.04",
      "type": "docker"
    }
  ],
  "provisioners": [
    {
      "inline": [
        "set -euo pipefail",
        "apt-get update",
        "apt-get dist-upgrade -y",
        "apt-get install -y ca-certificates curl gcc iproute2 python3 python3-dev sudo"
      ],
      "type": "shell"
    },
    {
      "galaxy_file": "./ansible-galaxy-requirements.yml",
      "inventory_directory": "./",
      "playbook_file": "./packer.yml",
      "type": "ansible"
    }
  ]
}

